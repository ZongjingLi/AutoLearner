# Data Download
First download the [PartNet dataset](https://partnet.cs.stanford.edu/), denoted as $DATA_DIR.

Then download the [Cart and Chair Category from PartNet Mobility Dataset](https://sapien.ucsd.edu/browse), denoted as $MOBILITY_DIR. Same as $DATA_DIR, $MOBILITY_DIR contains a list of ids of the cart shapes.

# Blender
We render synthetic images using [Blender2.78](https://www.blender.org/download/releases/2-78/), outputting both rendered images as well as a JSON file containing ground-truth scene information for each image.

Blender ships with its own installation of Python which is used to execute scripts that interact with Blender; you'll need to add the image_generation directory to Python path of Blender's bundled Python. The easiest way to do this is by adding a .pth file to the site-packages directory of Blender's Python, like this:

```
echo $PWD >> $BLENDER/$VERSION/python/lib/python3.5/site-packages/ptr.pth
```

where $BLENDER is the directory where Blender is installed and $VERSION is your Blender version; for example on Linux you might run:
```
echo $PWD > /usr/local/blender/2.78/python/lib/python3.5/site-packages/ptr.pth
```

Note that blender uses its own python and pip. So if we want to import python modules in our scripts and those modules are not installed. We first have to install the modules first. **blender 2.78 does not have pip installed**. To install pip, first cd into this folder:
```
cd $BLENDER/$VERSION/python/bin
```
and then 
```
wget https://bootstrap.pypa.io/pip/3.5/get-pip.py
```
after that, run
```
./python3.5m get-pip.py
```
this should have pip installed. run
```
./pip3.5 install [module]
```
to install the modules


on OSX you might run:

```
echo $PWD >> /Applications/blender/blender.app/Contents/Resources/2.78/python/lib/python3.5/site-packages/ptr.pth
```

On OSX the blender binary is located inside the blender.app directory; for convenience you may want to add the following alias to your ~/.bash_profile file:

alias blender='/Applications/blender/blender.app/Contents/MacOS/blender'

# PTR Image Generation
First, 
Images are generated by using Blender to invoke the script `render_images_partnet.py` like this:

```
blender --background --python render_images_partnet.py -- [args]
```

*e.g.,*
```
blender --background --python render_images_partnet.py -- --data_dir $DATA_DIR --mobility_dir $MOBILITY_DIR --num_images 2000 --tmp_dir tmp1 --gpu 1
```

Any arguments following the `--` will be captured by `render_images_partnet.py`.

This command should be run from the `image_generation` directory, since by default the script will load resources from the `data` directory.

When rendering on cluster machines without audio drivers installed you may need to add the `-noaudio` flag to the Blender invocation like this:

```
blender --background -noaudio --python render_images_partnet.py -- [args]
```

If you want to generate physical scenes, invoke `render_images_physics.py` like this:

```
blender --background --python render_images_physics.py -- [args]
```
